# Project Specification: AI Smart Helpdesk MVP

## Overview
**Goal:** Build a functional Helpdesk MVP with real-time chat and AI-augmented features (Sentiment Analysis, Smart Routing, RAG).
**Role:** Expert Full-Stack Developer utilizing the "Trinity Stack."

---

## 1. Technology Stack & Constraints

### Frontend
* **Framework:** Next.js latest (App Router)
* **Language:** TypeScript
* **Styling:** Tailwind CSS
* **Components:** Shadcn UI

### Backend (Microservice)
* **Runtime:** Python 3.10+
* **Framework:** FastAPI
* **Server:** Uvicorn

### Database & Auth
* **Platform:** Supabase
* **Database:** PostgreSQL with `pgvector`
* **Auth:** auth0 options for the routs for the time being
* **Realtime:** Supabase Realtime

### AI Processing
* **Sentiment:** TextBlob (CPU-optimized for speed)
* **Routing:** Transformers (Zero-Shot) or keyword extraction
* **RAG:** OpenAI Embeddings + Supabase Vector Store

---

## 2. Database Schema (Supabase)

Run this SQL in the Supabase SQL Editor to initialize the backend.

```sql
-- 1. Enable Vector Extension for RAG
create extension if not exists vector;

-- 2. Profiles Table (Public metadata for Auth users)
create table public.profiles (
  id uuid references auth.users on delete cascade not null primary key,
  email text not null,
  role text check (role in ('admin', 'agent', 'customer')) default 'customer',
  full_name text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Tickets Table
create table public.tickets (
  id bigint generated by default as identity primary key,
  customer_id uuid references public.profiles(id) not null,
  subject text not null,
  description text not null,
  status text check (status in ('open', 'resolved', 'closed')) default 'open',
  priority text check (priority in ('low', 'medium', 'high', 'critical')) default 'medium',
  sentiment_score float, -- AI Populated
  tags text, -- AI Populated
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. Messages Table (Stores Chat & Embeddings)
create table public.messages (
  id bigint generated by default as identity primary key,
  ticket_id bigint references public.tickets(id) on delete cascade not null,
  sender_id uuid references public.profiles(id) not null,
  content text not null,
  embedding vector(1536), -- Dimension for OpenAI text-embedding-3-small
  is_internal boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 5. RLS Policies (Security - Simplified for MVP)
alter table public.profiles enable row level security;
alter table public.tickets enable row level security;
alter table public.messages enable row level security;

create policy "Public profiles are viewable by everyone" on public.profiles for select using (true);
create policy "Users can insert their own profile" on public.profiles for insert with check (auth.uid() = id);

create policy "Agents view all tickets" on public.tickets for select using (
  exists (select 1 from public.profiles where id = auth.uid() and role = 'agent')
);
create policy "Customers view own tickets" on public.tickets for select using (auth.uid() = customer_id);
create policy "Everyone can create tickets" on public.tickets for insert with check (auth.uid() = customer_id);

create policy "View messages" on public.messages for select using (true);
create policy "Insert messages" on public.messages for insert with check (auth.uid() = sender_id);

-- 6. Vector Search Function (RPC)
create or replace function match_messages (
  query_embedding vector(1536),
  match_threshold float,
  match_count int
)
returns table (
  id bigint,
  content text,
  similarity float
)
language plpgsql
as $$
begin
  return query
  select
    messages.id,
    messages.content,
    1 - (messages.embedding <=> query_embedding) as similarity
  from messages
  where 1 - (messages.embedding <=> query_embedding) > match_threshold
  order by messages.embedding <=> query_embedding
  limit match_count;
end;
I am building an **AI Smart Helpdesk MVP** using the "Trinity Stack": Next.js (App Router), Python (FastAPI), and Supabase. I need you to act as an expert Full-Stack Developer to help me implement.
>

>
> **Your Instructions:**
> 1.  **Analyze the Spec:** Review the schema, project structure, and code snippets provided in the spec above. Note that the Python `jwt.decode` snippet might need syntax correction regarding the `algorithms` parameter.
> 2.  **Phase 1 - Initialization:** Don't write all the code at once. Let's start with **Project Initialization**.
> 3.  **Action:** Please give me the exact terminal commands to:
>     * Initialize the Next.js app with TypeScript and Tailwind.
>     * Initialize Shadcn UI.
>     * Set up the Python backend virtual environment and install the dependencies listed in the spec (`fastapi`, `uvicorn`, `textblob`, `supabase`, `python-jose`).
>     * Create the folder structure as defined in the "Project Structure" section.
>
> Once we have the environment set up, we will move to Supabase configuration. Ready?

use all the latest versions and include python in the project and make it as a single project